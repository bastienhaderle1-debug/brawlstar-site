<!--pages/profile.html-->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profil</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width:980px){ .grid-2{ grid-template-columns:1fr; } }
  </style>
</head>

<body>
  <header class="header container">
    <div class="headerbar">
      <div>
        <h1 data-title="PROFIL">ğŸ‘¤ PROFIL</h1>
        <p class="muted">Recherche un joueur par pseudo, ouvre un profil via ?u=UUID, ou gÃ¨re ton propre profil public.</p>

        <nav class="nav">
          <a href="../index.html">Accueil</a>
          <a href="./mybrawl.html">MyBrawl</a>
          <a href="./profile.html">Profil</a>
          <a href="./brawlers.html">Brawlers</a>
          <a href="./skins.html">Skins</a>
        </nav>
      </div>

      <div class="header-right">
        <div class="badge ko" id="globalAuthBadge">
          <span class="dot"></span>
          <span>Non connectÃ©</span>
        </div>

        <a class="seg-btn" href="./mybrawl.html">ğŸ‘¤ Mon compte</a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- ======================
         MON PROFIL (si connectÃ©)
         ====================== -->
    <section class="card" id="myProfileCard" style="display:none;">
      <h2 data-title="MON PROFIL">ğŸŒ MON PROFIL PUBLIC</h2>
      <p class="muted">Configure ton profil et publie ta liste de skins cochÃ©s (stockÃ©e par MyBrawl / Skins).</p>

      <section class="toolbar" style="margin: 12px 0 8px 0;">
        <div class="filter">
          <label>ConnectÃ© en tant que</label>
          <div class="muted" id="meLine">â€”</div>
        </div>

        <div style="display:flex; align-items:end; gap:10px; flex-wrap:wrap;">
          <button class="seg-btn" id="btnMeReload" type="button">ğŸ”„ Recharger</button>
          <button class="seg-btn" id="btnMeLogout" type="button">ğŸšª DÃ©connexion</button>
        </div>
      </section>

      <div class="grid-2">
        <div class="filter">
          <label for="meDisplayName">Pseudo (public)</label>
          <input class="input" id="meDisplayName" type="text" placeholder="ex: Bastien" />
        </div>

        <div class="filter">
          <label for="meBio">Bio (public)</label>
          <input class="input" id="meBio" type="text" placeholder="ex: Fan de Brawl Stars" />
        </div>
      </div>

      <div style="display:flex; gap:18px; flex-wrap:wrap; margin-top:10px;">
        <label style="display:flex; gap:8px; align-items:center; user-select:none;">
          <input type="checkbox" id="meIsPublic" checked />
          <span>Profil public</span>
        </label>

        <label style="display:flex; gap:8px; align-items:center; user-select:none;">
          <input type="checkbox" id="meShowOwned" checked />
          <span>Afficher mes skins</span>
        </label>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
        <button class="seg-btn is-active" id="btnMeSave" type="button">ğŸ’¾ Enregistrer</button>
        <button class="seg-btn" id="btnMePublish" type="button">ğŸ“¤ Publier mes skins cochÃ©s</button>
        <button class="seg-btn" id="btnMeOpen" type="button">ğŸ”— Ouvrir mon profil public</button>
        <button class="seg-btn" id="btnMeCopy" type="button">ğŸ“‹ Copier le lien</button>
      </div>

      <p class="muted" id="meMsg" style="margin-top:10px;"></p>
    </section>

    <!-- ======================
         MESSAGE si non connectÃ©
         ====================== -->
    <section class="card" id="needAuthCard" style="display:none; margin-top:14px;">
      <h2 data-title="CONNEXION">ğŸ”’ Connexion requise</h2>
      <p class="muted">Pour Ã©diter ton profil public, connecte-toi sur MyBrawl.</p>
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
        <a class="seg-btn is-active" href="./mybrawl.html">ğŸ‘¤ Aller sur MyBrawl</a>
      </div>
    </section>

    <!-- ======================
         RECHERCHE pseudo
         ====================== -->
    <section class="card" style="margin-top:14px;">
      <h2 data-title="RECHERCHE">ğŸ” RECHERCHE</h2>
      <p class="muted">Tape un pseudo (profil public uniquement) et sÃ©lectionne un rÃ©sultat.</p>

      <section class="toolbar" style="margin-bottom:10px;">
        <div class="filter" style="min-width:260px; flex:1;">
          <label for="searchName">Pseudo</label>
          <input id="searchName" class="input" type="text" placeholder="ex: BabaXkiwi" />
        </div>

        <div style="display:flex; align-items:end; gap:10px; flex-wrap:wrap;">
          <button class="seg-btn is-active" id="btnSearch" type="button">Rechercher</button>
          <button class="seg-btn" id="btnClear" type="button">Effacer</button>
        </div>
      </section>

      <p class="muted" id="searchMsg"></p>
      <div class="cards" id="searchResults" style="grid-template-columns: repeat(2, minmax(240px, 1fr));"></div>
    </section>

    <!-- Erreur -->
    <section class="card" id="errorCard" style="display:none; margin-top:14px;">
      <h2 data-title="ERREUR">âŒ ERREUR</h2>
      <p class="muted" id="errorMsg"></p>
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
        <a class="seg-btn" href="../index.html">â¬… Retour accueil</a>
        <a class="seg-btn" href="./mybrawl.html">ğŸ‘¤ Aller sur MyBrawl</a>
      </div>
    </section>

    <!-- Profil consultÃ© -->
    <section class="card" id="profileCard" style="display:none; margin-top:14px;">
      <h2 id="displayName">â€”</h2>
      <p class="muted" id="bio">â€”</p>
      <p class="muted" id="updatedLine"></p>
      <p class="muted" id="shareLine"></p>

      <div class="stats-grid">
        <div class="stat">
          <div class="stat-label">Skins possÃ©dÃ©s (public)</div>
          <div class="stat-value" id="statOwned">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">Total skins (base)</div>
          <div class="stat-value" id="statTotal">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">Progression</div>
          <div class="stat-value" id="statPct">0%</div>
        </div>
      </div>

      <div class="progress"><div class="progress-bar" id="progressBar" style="width:0%"></div></div>
      <p class="muted" id="publicModeLine" style="margin-top:12px;"></p>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
        <button class="seg-btn" id="btnCopyLink" type="button">ğŸ”— Copier le lien</button>
      </div>
    </section>

    <!-- Filtres skins du profil consultÃ© -->
    <section class="toolbar" id="toolbar" style="display:none; margin-top:14px;">
      <div class="filter">
        <label for="searchSkins">Recherche skins</label>
        <input id="searchSkins" class="input" type="text" placeholder="ex: shelly, star..." />
      </div>

      <div class="filter">
        <label for="filterRarity">RaretÃ©</label>
        <select id="filterRarity" class="select"></select>
      </div>
    </section>

    <!-- Liste skins du profil consultÃ© -->
    <section id="skinsSection" style="display:none; margin-top:8px;">
      <h2 data-title="SKINS">âœ… SKINS</h2>
      <p class="muted" id="resultCount"></p>
      <div class="cards" id="cards"></div>
    </section>
  </main>

  <footer class="footer container">
    <a href="../index.html">â¬… Retour Ã  lâ€™accueil</a>
  </footer>

  <script src="../js/toast.js"></script>
  <script src="../js/guard.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../data/supabase-client.js"></script>
  <script src="../data/skins-data.js"></script>

  <script src="../js/owned-service.js"></script>
  <script src="../js/profile.js"></script>
  <script src="../js/site.js"></script>
</body>
</html>
