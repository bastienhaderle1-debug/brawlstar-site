<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skins</title>
  <link rel="stylesheet" href="../style.css" />
</head>

<body>
  <header class="header">
    <h1>ðŸŽ¨ Skins</h1>
    <p>Classement des skins par brawler ou par thÃ¨me.</p>

    <nav class="nav">
      <a href="../index.html">Accueil</a>
      <a href="./brawlers.html">Brawlers</a>
      <a href="./skins.html">Skins</a>
    </nav>
  </header>

  <main class="container">
    <section class="toolbar">
      <div class="segmented" role="group" aria-label="Mode de tri">
        <button class="seg-btn is-active" id="modeBrawler" type="button">Par brawler</button>
        <button class="seg-btn" id="modeCategory" type="button">Par thÃ¨me</button>
      </div>

      <div class="filter">
        <label for="select" id="selectLabel">Choisir un brawler</label>
        <select id="select" class="select"></select>
      </div>

      <div class="filter">
        <label for="rarity">RaretÃ©</label>
        <select id="rarity" class="select">
          <option value="all">Toutes</option>
        </select>
      </div>

      <div class="filter">
        <label for="search">Recherche</label>
        <input id="search" class="input" type="text" placeholder="ex: star, pirate, gold..." />
      </div>
    </section>

    <section>
      <h2 id="resultTitle">RÃ©sultats</h2>
      <p class="muted" id="resultCount"></p>

      <div class="cards" id="cards"></div>
    </section>
  </main>

  <footer class="footer">
    <a href="../index.html">â¬… Retour Ã  lâ€™accueil</a>
  </footer>

  <!-- 1) On charge d'abord les donnÃ©es -->
  <script src="../data/skins-data.js"></script>

  <!-- 2) Puis la logique de la page -->
  <script>
    // DonnÃ©es
    const skins = window.SKINS ?? [];

    // Ordre de raretÃ© (comme tu l'as donnÃ©)
    const RARITY_ORDER = [
      "Rare",
      "Super Rare",
      "Epic",
      "Mythique",
      "LÃ©gendaire",
      "Hypercharge",
    ];

    // Classe CSS associÃ©e Ã  chaque raretÃ©
    const RARITY_CLASS = {
      "Rare": "rarity-rare",
      "Super Rare": "rarity-super-rare",
      "Epic": "rarity-epic",
      "Mythique": "rarity-mythic",
      "LÃ©gendaire": "rarity-legendary",
      "Hypercharge": "rarity-hypercharge",
    };

    // --- State ---
    let mode = "brawler"; // "brawler" | "category"

    // --- Elements ---
    const modeBrawlerBtn = document.getElementById("modeBrawler");
    const modeCategoryBtn = document.getElementById("modeCategory");
    const selectLabel = document.getElementById("selectLabel");
    const select = document.getElementById("select");
    const rarity = document.getElementById("rarity");
    const search = document.getElementById("search");
    const cards = document.getElementById("cards");
    const resultCount = document.getElementById("resultCount");
    const resultTitle = document.getElementById("resultTitle");

    // --- Utils ---
    function uniqueSorted(arr) {
      return [...new Set(arr)].sort((a, b) => a.localeCompare(b, "fr"));
    }

    // Remplit le select Brawler / ThÃ¨me selon le mode
    function buildOptions() {
      const values = mode === "brawler"
        ? uniqueSorted(skins.map(s => s.brawler).filter(Boolean))
        : uniqueSorted(skins.map(s => s.category).filter(Boolean));

      select.innerHTML = "";

      const optAll = document.createElement("option");
      optAll.value = "all";
      optAll.textContent = "Tous";
      select.appendChild(optAll);

      values.forEach(v => {
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        select.appendChild(opt);
      });

      selectLabel.textContent = mode === "brawler" ? "Choisir un brawler" : "Choisir un thÃ¨me";
      resultTitle.textContent = mode === "brawler" ? "Skins par brawler" : "Skins par thÃ¨me";
    }

    // Remplit le select RaretÃ© dans l'ordre officiel
    function buildRarities() {
      rarity.innerHTML = `<option value="all">Toutes</option>`;

      // Optionnel : si tu veux n'afficher que celles qui existent dans tes donnÃ©es, dÃ©commente le bloc ci-dessous
      // const existing = new Set(skins.map(s => s.rarity).filter(Boolean));

      RARITY_ORDER.forEach(r => {
        // Si tu veux n'afficher que les raretÃ©s prÃ©sentes dans tes donnÃ©es, utilise :
        // if (!existing.has(r)) return;

        const opt = document.createElement("option");
        opt.value = r;
        opt.textContent = r;
        rarity.appendChild(opt);
      });
    }

    // Affiche les cartes selon les filtres
    function render() {
      const selected = select.value || "all";
      const selectedRarity = rarity.value || "all";
      const q = (search.value || "").toLowerCase().trim();

      const filtered = skins.filter(s => {
        const matchMode =
          selected === "all" ||
          (mode === "brawler" ? s.brawler === selected : s.category === selected);

        const matchRarity =
          selectedRarity === "all" || s.rarity === selectedRarity;

        const matchSearch =
          q === "" ||
          (s.name || "").toLowerCase().includes(q) ||
          (s.brawler || "").toLowerCase().includes(q) ||
          (s.category || "").toLowerCase().includes(q) ||
          (s.rarity || "").toLowerCase().includes(q);

        return matchMode && matchRarity && matchSearch;
      });

      cards.innerHTML = "";

      filtered.forEach(s => {
        const el = document.createElement("article");
        el.className = "card";

        const rarityClass = RARITY_CLASS[s.rarity] ?? "";

        el.innerHTML = `
          <div class="row">
            <span class="pill">${s.category ?? "â€”"}</span>
            <span class="pill ${rarityClass}">${s.rarity ?? "â€”"}</span>
          </div>
          <h3>${s.name ?? "â€”"}</h3>
          <p class="muted">Brawler : <strong>${s.brawler ?? "â€”"}</strong></p>
        `;

        cards.appendChild(el);
      });

      resultCount.textContent = `${filtered.length} skin(s) affichÃ©(s)`;
    }

    function setMode(nextMode) {
      mode = nextMode;

      const brawlerActive = mode === "brawler";
      modeBrawlerBtn.classList.toggle("is-active", brawlerActive);
      modeCategoryBtn.classList.toggle("is-active", !brawlerActive);

      buildOptions();
      render();
    }

    // --- Events ---
    modeBrawlerBtn.addEventListener("click", () => setMode("brawler"));
    modeCategoryBtn.addEventListener("click", () => setMode("category"));
    select.addEventListener("change", render);
    rarity.addEventListener("change", render);
    search.addEventListener("input", render);

    // --- Init ---
    buildRarities();
    buildOptions();
    render();
  </script>
</body>
</html>
